apiVersion: v1
kind: Pod
metadata:
  name: pg-restore
spec:
  template:
    metadata:
      annotations:
        injector.tumblr.com/request: vault-init-container-aws
  serviceAccountName: service-account-name
  containers:
  - name: pg-restore
    image: registry.uw.systems/energy/postgres-base-backup:latest
    command: ['sh', '-c', 'backup.sh']
    env:
      - name: S3_REGION
        value: "eu-west-1"
      - name: S3_BUCKET
        value: "s3-bucket-name"
      - name: S3_PREFIX
        value: "backups"
      - name: POSTGRES_HOST
        value: "postgres"
      - name: POSTGRES_USER
        valueFrom:
          secretKeyRef:
            name: postgresql
            key: user
      - name: POSTGRES_PASSWORD
        valueFrom:
          secretKeyRef:
            name: postgresql
            key: user-password
      - name: POSTGRES_DATABASE
        value: "database"
      - name: POSTGRES_PORT
        value: "5432"
      - name: TIMESTAMP
        value: "2023-12-28T15:16:06"
    restartPolicy: never
